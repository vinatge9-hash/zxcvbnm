<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:300,400,500,600,700&display=swap" rel="stylesheet">
  <!--  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>niyantri Coffee - Cart</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="font-family: 'Inter', sans-serif;" class="bg-yellow-50 text-gray-900 w-full min-h-screen">
  <!-- Navbar -->
  <header class="w-full fixed top-0 left-0 z-50 bg-black/50 text-white backdrop-blur-sm">
    <nav class="max-w-full px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <span class="text-2xl">☕</span>
        <a href="./index.html" class="font-bold text-xl">niyantri</a>
      </div>
      <ul class="flex items-center space-x-6 text-sm uppercase tracking-wider">
        <li><a href="./index.html" class="hover:underline">Home</a></li>
        <li><a href="./menu.html" class="hover:underline">Menu</a></li>
        <li><a href="./cart.html" class="hover:underline">Cart</a></li>
        <li><a href="./about.html" class="hover:underline">About</a></li>
        <li><a href="./contact.html" class="hover:underline">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main class="pt-28 w-full px-6">
    <section class="max-w-full">
      <h1 class="text-2xl md:text-3xl font-semibold mb-4">Your Cart</h1>
      <div id="cart-items" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      <div class="mt-6 border-t pt-4 md:flex md:items-center md:justify-between">
        <div class="text-sm text-gray-700">Taxes and shipping calculated at checkout.</div>
        <div class="text-xl font-semibold" id="cart-total">Total: $0.00</div>
      </div>
      <div id="paypal-button-container" class="my-4"></div>
      <div class="mt-4 flex space-x-2">
        <a href="./menu.html" class="inline-block bg-yellow-400 text-black font-semibold py-2 px-4 rounded">Continue Shopping</a>
        <button onclick="clearCart()" class="inline-block bg-gray-200 text-black font-semibold py-2 px-4 rounded">Clear Cart</button>
      </div>
    </section>
  </main>

  <footer class="w-full bg-black text-white py-6 mt-8">
    <div class="text-center text-sm">© 2025 niyantri Coffee</div>
  </footer>

  <script>
    // Cart helpers
    function loadCart() {
      return JSON.parse(localStorage.getItem('niyantri_cart') || '[]');
    }
    function saveCart(cart) {
      localStorage.setItem('niyantri_cart', JSON.stringify(cart));
      renderCart();
    }
    function clearCart() {
      localStorage.removeItem('niyantri_cart');
      renderCart();
    }

    function renderCart() {
      const items = loadCart();
      const container = document.getElementById('cart-items');
      container.innerHTML = '';
      let total = 0;
      if (items.length === 0) {
        container.innerHTML = '<div class="col-span-3">Your cart is empty. Add some coffee from the Menu!</div>';
      } else {
        items.forEach((it, idx) => {
          const row = document.createElement('div');
          row.className = 'bg-white rounded-lg shadow p-4 flex items-center';
          row.innerHTML = `
            <div class="flex-1">
              <div class="font-semibold">${it.name}</div>
              <div class="text-sm text-gray-600">$${parseFloat(it.price).toFixed(2)} each</div>
            </div>
            <div class="flex items-center space-x-2">
              <input type="number" min="1" class="w-20 px-2 py-1 border rounded" value="${it.qty}" onchange="updateQty(${idx}, this.value)" />
            </div>`;
          total += (it.price * (parseInt(it.qty) || 1));
          container.appendChild(row);
        });
      }
      document.getElementById('cart-total').textContent = 'Total: $' + total.toFixed(2);

      // Render PayPal after cart update (ensure SDK is loaded)
      if (typeof paypal !== 'undefined') {
        renderPayPalButton(total);
      }
    }

    function updateQty(index, value) {
      const cart = loadCart();
      cart[index].qty = Math.max(1, parseInt(value) || 1);
      saveCart(cart);
    }

    function renderPayPalButton(total) {
      // Clear previous button if re-rendering
      const container = document.getElementById('paypal-button-container');
      container.innerHTML = '';
      // Only render if total > 0
      if (total <= 0) return;
      paypal.Buttons({
        style: { layout: 'vertical', color: 'gold', shape: 'pill', label: 'pay' },
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{ amount: { value: total.toFixed(2) } }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert('Payment completed by ' + details.payer.name.given_name);
            clearCart();
          });
        }
      }).render('#paypal-button-container');
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      renderCart();
      // Load PayPal script dynamically to ensure sandbox works
      const script = document.createElement('script');
      script.src = 'https://www.paypal.com/sdk/js?client-id=sb&currency=USD';
      script.onload = () => {
        // If there is a non-zero total after renderCart, render the button
        const totalEl = document.getElementById('cart-total');
        const totalText = totalEl.textContent;
        const total = parseFloat(totalText.replace(/[^0-9.]/g, '')) || 0;
        if (total > 0) renderPayPalButton(total);
      };
      document.body.appendChild(script);

      // Update cart count in navbar when storage changes
      window.addEventListener('storage', function() {
        const cart = loadCart();
        const count = cart.reduce((a, b) => a + (b.qty || 1), 0);
        const el = document.getElementById('nav-cart-count');
        if (el) el.textContent = count;
      });
    });
  </script>
</body>
</html>
